<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM8s Brushless MCP: BLDC State</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STM8s Brushless MCP
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Brushless motor controller on STM8s</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___b_l_d_c__sm.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">BLDC State</div>  </div>
</div><!--header-->
<div class="contents">

<p>BLDC state management and timing control.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6af60a6d9b9c041b0b35af96cb8cd00e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___b_l_d_c__sm.html#ga6af60a6d9b9c041b0b35af96cb8cd00e">BL_reset</a> (void)</td></tr>
<tr class="memdesc:ga6af60a6d9b9c041b0b35af96cb8cd00e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize/reset motor.  <a href="group___b_l_d_c__sm.html#ga6af60a6d9b9c041b0b35af96cb8cd00e">More...</a><br /></td></tr>
<tr class="separator:ga6af60a6d9b9c041b0b35af96cb8cd00e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafbd4585c8508bff4da3ff9ee0a9f4a2d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___b_l_d_c__sm.html#gafbd4585c8508bff4da3ff9ee0a9f4a2d">BLDC_PWMDC_Set</a> (uint8_t dc)</td></tr>
<tr class="memdesc:gafbd4585c8508bff4da3ff9ee0a9f4a2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets motor speed from commanded throttle/UI setting.  <a href="group___b_l_d_c__sm.html#gafbd4585c8508bff4da3ff9ee0a9f4a2d">More...</a><br /></td></tr>
<tr class="separator:gafbd4585c8508bff4da3ff9ee0a9f4a2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga40f6a780db77b873ca4fc6a1ff5a5f06"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___b_l_d_c__sm.html#ga40f6a780db77b873ca4fc6a1ff5a5f06">BLDC_PWMDC_Get</a> (void)</td></tr>
<tr class="memdesc:ga40f6a780db77b873ca4fc6a1ff5a5f06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accessor for Commanded Duty Cycle.  <a href="group___b_l_d_c__sm.html#ga40f6a780db77b873ca4fc6a1ff5a5f06">More...</a><br /></td></tr>
<tr class="separator:ga40f6a780db77b873ca4fc6a1ff5a5f06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8b9cc5c8b0c4a4d4175e213564ff9b30"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___b_l_d_c__sm.html#ga8b9cc5c8b0c4a4d4175e213564ff9b30">get_commutation_period</a> (void)</td></tr>
<tr class="memdesc:ga8b9cc5c8b0c4a4d4175e213564ff9b30"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accessor for commutation period.  <a href="group___b_l_d_c__sm.html#ga8b9cc5c8b0c4a4d4175e213564ff9b30">More...</a><br /></td></tr>
<tr class="separator:ga8b9cc5c8b0c4a4d4175e213564ff9b30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga442d26a780c245d8e7b59ddf1917e67d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="bldc__sm_8h.html#a6d97331b7d9c5e41e55e28a253cf2a5a">BL_RUNSTATE_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___b_l_d_c__sm.html#ga442d26a780c245d8e7b59ddf1917e67d">BL_get_state</a> (void)</td></tr>
<tr class="memdesc:ga442d26a780c245d8e7b59ddf1917e67d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accessor for state variable.  <a href="group___b_l_d_c__sm.html#ga442d26a780c245d8e7b59ddf1917e67d">More...</a><br /></td></tr>
<tr class="separator:ga442d26a780c245d8e7b59ddf1917e67d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga177d26c212c7d70847a3ad080d923c00"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___b_l_d_c__sm.html#ga177d26c212c7d70847a3ad080d923c00">BL_get_ct_mode</a> (void)</td></tr>
<tr class="memdesc:ga177d26c212c7d70847a3ad080d923c00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accessor for state variable.  <a href="group___b_l_d_c__sm.html#ga177d26c212c7d70847a3ad080d923c00">More...</a><br /></td></tr>
<tr class="separator:ga177d26c212c7d70847a3ad080d923c00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga730e540e3754fc2a6edeb292b5e6d43e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___b_l_d_c__sm.html#ga730e540e3754fc2a6edeb292b5e6d43e">BLDC_Update</a> (void)</td></tr>
<tr class="memdesc:ga730e540e3754fc2a6edeb292b5e6d43e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Top level task which perform commutation timing update.  <a href="group___b_l_d_c__sm.html#ga730e540e3754fc2a6edeb292b5e6d43e">More...</a><br /></td></tr>
<tr class="separator:ga730e540e3754fc2a6edeb292b5e6d43e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>BLDC state management and timing control. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga177d26c212c7d70847a3ad080d923c00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga177d26c212c7d70847a3ad080d923c00">&#9670;&nbsp;</a></span>BL_get_ct_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t BL_get_ct_mode </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accessor for state variable. </p>
<p>Control Mode is TRUE if transitioned from open-loop to closed-loop commutation control.</p>
<dl class="section return"><dt>Returns</dt><dd>state value </dd></dl>

</div>
</div>
<a id="ga442d26a780c245d8e7b59ddf1917e67d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga442d26a780c245d8e7b59ddf1917e67d">&#9670;&nbsp;</a></span>BL_get_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="bldc__sm_8h.html#a6d97331b7d9c5e41e55e28a253cf2a5a">BL_RUNSTATE_t</a> BL_get_state </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accessor for state variable. </p>
<p>External modules can query if the machine is running or not. There are only these two states bases on the set speed greater or less than the shutdown threshold.</p>
<dl class="section return"><dt>Returns</dt><dd>state value </dd></dl>

</div>
</div>
<a id="ga6af60a6d9b9c041b0b35af96cb8cd00e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6af60a6d9b9c041b0b35af96cb8cd00e">&#9670;&nbsp;</a></span>BL_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BL_reset </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize/reset motor. </p>
<p>System reset / re-arm function (has to be called both at program startup as well as following a fault condition state.</p>
<p>expect to be called from non-ISR/CS context (i.e. from UI handler) </p>

</div>
</div>
<a id="ga40f6a780db77b873ca4fc6a1ff5a5f06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga40f6a780db77b873ca4fc6a1ff5a5f06">&#9670;&nbsp;</a></span>BLDC_PWMDC_Get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t BLDC_PWMDC_Get </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accessor for Commanded Duty Cycle. </p>
<dl class="section return"><dt>Returns</dt><dd>Commanded Duty Cycle </dd></dl>

</div>
</div>
<a id="gafbd4585c8508bff4da3ff9ee0a9f4a2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafbd4585c8508bff4da3ff9ee0a9f4a2d">&#9670;&nbsp;</a></span>BLDC_PWMDC_Set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BLDC_PWMDC_Set </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets motor speed from commanded throttle/UI setting. </p>
<p>The motor is started once reaching the ramp speed threshold, and allowed to slow down to the low shutoff threshold. UI Speed is shared with background task so this function should be invoked only from within a CS.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dc</td><td>Speed input which can be in the range [0:255] </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga730e540e3754fc2a6edeb292b5e6d43e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga730e540e3754fc2a6edeb292b5e6d43e">&#9670;&nbsp;</a></span>BLDC_Update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BLDC_Update </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Top level task which perform commutation timing update. </p>
<p>Periodic state machine update. </p>

</div>
</div>
<a id="ga8b9cc5c8b0c4a4d4175e213564ff9b30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8b9cc5c8b0c4a4d4175e213564ff9b30">&#9670;&nbsp;</a></span>get_commutation_period()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t get_commutation_period </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accessor for commutation period. </p>
<dl class="section return"><dt>Returns</dt><dd>commutation period </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
